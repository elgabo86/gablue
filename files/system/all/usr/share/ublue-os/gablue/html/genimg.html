<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="img-src 'self' data:;">
    <title>Générateur d'images IA</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <style>
        :root {
            --primary: #7c3aed;
            --primary-dark: #6d28d9;
            --secondary: #22d3ee;
            --dark: #1f2937;
            --light: #e5e7eb;
            --danger: #ef4444;
            --success: #10b981;
            --warning: #f59e0b;
            --background: #111827;
            --card-background: #1f2937;
            --text: #d1d5db;
            --text-muted: #9ca3af;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--background);
            color: var(--text);
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 1.5rem;
        }

        header {
            text-align: center;
            margin: 0.5rem 0;
        }

        h1 {
            font-size: 1.5rem;
            color: var(--light);
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }

        .app-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
            background: var(--card-background);
            border-radius: 12px數 box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        .controls,
        .image-preview {
            padding: 1.5rem;
        }

        .image-preview {
            background: var(--dark);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 500px;
            position: relative;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            font-size: 0.95rem;
        }

        input,
        textarea,
        select {
            width: 100%;
            padding: 0.7rem;
            border: 1px solid var(--text-muted);
            border-radius: 8px;
            font-size: 0.9rem;
            background: var(--dark);
            color: var(--text);
            transition: all 0.3s ease;
        }

        textarea {
            min-height: 100px;
            resize: vertical;
        }

        input:focus,
        textarea:focus,
        select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(124, 58, 237, 0.2);
        }

        .seed-container {
            position: relative;
            display: flex;
            align-items: center;
        }

        .seed-container input {
            padding-right: 2.5rem;
            /* Espace pour le bouton */
        }

        .clear-seed-btn {
            position: absolute;
            right: 0.5rem;
            top: 50%;
            transform: translateY(-50%);
            background: transparent;
            border: none;
            color: var(--text-muted);
            font-size: 0.9rem;
            cursor: pointer;
            padding: 0.2rem;
            transition: color 0.3s ease;
            display: flex;
            align-items: center;
            z-index: 10;
        }

        .clear-seed-btn:hover {
            color: var(--danger);
        }

        .btn {
            padding: 0.7rem 1.2rem;
            background-color: var(--primary);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn:hover {
            background-color: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(124, 58, 237, 0.4);
        }

        .btn:disabled {
            background-color: var(--text-muted);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .btn-block {
            display: block;
            width: 100%;
        }

        .btn-danger {
            background-color: var(--danger);
        }

        .btn-danger:hover {
            background-color: #dc2626;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .checkbox-group input {
            width: auto;
        }

        .checkbox-group label {
            margin-bottom: 0;
            font-weight: normal;
            font-size: 0.85rem;
        }

        .generated-image {
            max-width: 100%;
            max-height: 400px;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            cursor: pointer;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease-in-out, visibility 0.3s ease-in-out;
            object-fit: contain;
        }

        .generated-image.show {
            opacity: 1;
            visibility: visible;
        }

        .placeholder {
            text-align: center;
            color: var(--text-muted);
        }

        .placeholder i {
            font-size: 3rem;
            margin-bottom: 0.8rem;
        }

        .loading {
            display: none;
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 10;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid var(--text-muted);
            border-top: 4px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 0.8rem;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        .history {
            margin-top: 1.5rem;
            display: none;
        }

        .history.show {
            display: block;
        }

        .history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.8rem;
        }

        .history h3 {
            margin-bottom: 0.8rem;
            color: var(--primary);
            font-size: 1.2rem;
        }

        .history-items {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 0.8rem;
        }

        .history-item {
            border-radius: 8px;
            overflow: hidden;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            animation: fadeInUp 0.3s ease forwards;
        }

        @keyframes fadeInUp {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .history-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.4);
        }

        .history-item img {
            width: 100%;
            height: 120px;
            object-fit: cover;
        }

        .history-item .prompt {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 0.4rem;
            font-size: 0.7rem;
            display: none;
        }

        .history-item:hover .prompt {
            display: block;
        }

        .history-delete-btn,
        .history-preview-btn {
            position: absolute;
            top: 4px;
            background: var(--danger);
            color: white;
            border: none;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 0.7rem;
            cursor: pointer;
            display: none;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .history-preview-btn {
            left: 4px;
            background: var(--primary);
        }

        .history-delete-btn {
            right: 4px;
        }

        .history-item:hover .history-delete-btn,
        .history-item:hover .history-preview-btn {
            display: flex;
        }

        .history-delete-btn:hover {
            background: #dc2626;
            transform: scale(1.1);
        }

        .history-preview-btn:hover {
            background: var(--primary-dark);
            transform: scale(1.1);
        }

        footer {
            text-align: center;
            margin-top: 1.5rem;
            color: var(--text-muted);
            font-size: 0.8rem;
        }

        .toast {
            position: fixed;
            bottom: 15px;
            right: 15px;
            background: var(--dark);
            color: white;
            padding: 0.8rem 1.2rem;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.4);
            transform: translateY(100px);
            opacity: 0;
            transition: all 0.3s ease;
            z-index: 3000;
            font-size: 0.9rem;
        }

        .toast.show {
            transform: translateY(0);
            opacity: 1;
        }

        .toast.success {
            background: var(--success);
        }

        .toast.error {
            background: var(--danger);
        }

        .image-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.9);
            z-index: 2000;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1rem;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease-in-out;
        }

        .image-overlay.show {
            opacity: 1;
            pointer-events: auto;
        }

        .image-overlay img {
            max-width: 90%;
            max-height: 80vh;
            border-radius: 8px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.5);
            opacity: 0;
            transition: opacity 0.3s ease-in-out 0.05s;
        }

        .image-overlay.show img {
            opacity: 1;
        }

        .image-overlay .close-btn {
            position: absolute;
            top: 0.8rem;
            right: 0.8rem;
            background: var(--danger);
            color: white;
            border: none;
            border-radius: 50%;
            width: 32px;
            height: 32px;
            font-size: 1rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .image-overlay .close-btn:hover {
            background: #dc2626;
            transform: scale(1.1);
        }

        .image-overlay .overlay-buttons {
            position: absolute;
            bottom: 0.8rem;
            right: 0.8rem;
            display: flex;
            gap: 0.8rem;
        }

        .image-overlay .copy-btn,
        .image-overlay .download-btn {
            background: var(--primary);
            color: white;
            padding: 0.6rem 1rem;
            border-radius: 8px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.85rem;
        }

        .image-overlay .copy-btn:hover,
        .image-overlay .download-btn:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
        }

        .image-overlay .delete-btn {
            position: absolute;
            bottom: 0.8rem;
            left: 0.8rem;
            background: var(--danger);
            color: white;
            padding: 0.6rem 1rem;
            border-radius: 8px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.85rem;
        }

        .image-overlay .delete-btn:hover {
            background: #dc2626;
            transform: translateY(-2px);
        }

        .batch-container {
            display: flex;
            gap: 0.8rem;
            align-items: center;
        }

        .batch-container select {
            width: 80px;
            padding: 0.7rem;
            border: 1px solid var(--text-muted);
            border-radius: 8px;
            font-size: 0.9rem;
            background: var(--dark);
            color: var(--text);
        }

        @media (max-width: 768px) {
            .app-container {
                grid-template-columns: 1fr;
                border-radius: 12px;
            }

            .container {
                padding: 1rem;
            }

            h1 {
                font-size: 1.2rem;
            }

            .controls,
            .image-preview {
                padding: 1rem;
            }

            .image-preview {
                min-height: 300px;
            }

            .generated-image {
                max-height: 300px;
            }

            .form-group {
                margin-bottom: 0.8rem;
            }

            label {
                font-size: 0.9rem;
            }

            input,
            textarea,
            select {
                font-size: 0.85rem;
                padding: 0.6rem;
            }

            .seed-container input {
                padding-right: 2rem;
            }

            .clear-seed-btn {
                right: 0.3rem;
                font-size: 0.8rem;
            }

            .btn {
                font-size: 0.85rem;
                padding: 0.6rem 1rem;
            }

            .history-items {
                grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            }

            .history-item img {
                height: 100px;
            }

            .history-item .prompt {
                font-size: 0.65rem;
            }

            .history h3 {
                font-size: 0.9rem;
            }

            .history-header {
                flex-wrap: nowrap;
                gap: 0.5rem;
            }

            .history-header .btn {
                font-size: 0.8rem;
                padding: 0.5rem 0.8rem;
            }

            .toast {
                font-size: 0.8rem;
                padding: 0.6rem 1rem;
            }

            .image-overlay img {
                max-height: 70vh;
            }
        }

        @media (max-width: 480px) {
            h1 {
                font-size: 1rem;
            }

            .image-preview {
                min-height: 200px;
            }

            .generated-image {
                max-height: 200px;
            }

            .history-items {
                grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
            }

            .history-item img {
                height: 80px;
            }

            .history-delete-btn,
            .history-preview-btn {
                width: 18px;
                height: 18px;
                font-size: 0.6rem;
            }

            .image-overlay img {
                max-height: 70vh;
            }

            .image-overlay .copy-btn,
            .image-overlay .download-btn,
            .image-overlay .delete-btn {
                font-size: 0.8rem;
                padding: 0.5rem 0.8rem;
            }

            .image-overlay .close-btn {
                width: 28px;
                height: 28px;
                font-size: 0.9rem;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <header>
            <h1>Générateur d'images IA</h1>
        </header>

        <div class="app-container">
            <div class="controls">
                <div class="form-group">
                    <label for="model">Modèle</label>
                    <select id="model" name="model">
                        <option value="flux" selected>Flux (par défaut)</option>
                        <option value="turbo">Turbo</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="dimensions">Dimensions</label>
                    <select id="dimensions" name="dimensions">
                        <option value="512x512">512x512 (Carré, 1:1)</option>
                        <option value="1024x1024">1024x1024 (Carré, 1:1)</option>
                        <option value="800x600">800x600 (Paysage, 4:3)</option>
                        <option value="1024x576">1024x576 (Paysage, 16:9)</option>
                        <option value="1280x720" selected>1280x720 (Paysage, 16:9)</option>
                        <option value="600x800">600x800 (Portrait, 3:4)</option>
                        <option value="576x1024">576x1024 (Portrait, 9:16)</option>
                        <option value="720x1280">720x1280 (Portrait, 9:16)</option>
                        <option value="1600x400">1600x400 (Ultrawide, 4:1)</option>
                        <option value="1920x480">1920x480 (Ultrawide, 4:1)</option>
                        <option value="2048x512">2048x512 (Ultrawide, 4:1)</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="seed">Graine (laisser vide pour aléatoire)</label>
                    <div class="seed-container">
                        <input type="number" id="seed" placeholder="Graine aléatoire">
                        <button class="clear-seed-btn" id="clear-seed-btn"><i class="fas fa-times"></i></button>
                    </div>
                </div>

                <div class="form-group">
                    <label for="style">Style</label>
                    <select id="style" name="style">
                        <option value="default" selected>Défaut</option>
                        <optgroup label="Populaires">
                            <option value="anime">Anime</option>
                            <option value="realistic">Réaliste</option>
                            <option value="cartoon">Cartoon</option>
                            <option value="oilpainting">Peinture à l'huile</option>
                            <option value="watercolor">Aquarelle</option>
                            <option value="sketch">Croquis</option>
                            <option value="photorealistic">Photoréaliste</option>
                            <option value="digitalart">Art numérique</option>
                            <option value="3drender">Rendu 3D</option>
                            <option value="comic">Bande dessinée</option>
                        </optgroup>
                        <optgroup label="Artistiques Classiques">
                            <option value="artdeco">Art Déco</option>
                            <option value="baroque">Baroque</option>
                            <option value="bauhaus">Bauhaus</option>
                            <option value="chiaroscuro">Chiaroscuro</option>
                            <option value="expressionist">Expressionniste</option>
                            <option value="gouache">Gouache</option>
                            <option value="marble">Marbre</option>
                            <option value="mosaic">Mosaïque</option>
                            <option value="popart">Pop Art</option>
                            <option value="surrealist">Surréaliste</option>
                            <option value="ukiyo-e">Ukiyo-e</option>
                            <option value="renaissance">Renaissance</option>
                            <option value="impressionist">Impressionniste</option>
                            <option value="cubist">Cubiste</option>
                            <option value="fauvist">Fauviste</option>
                            <option value="romanticism">Romantisme</option>
                            <option value="neoclassical">Néo-classique</option>
                            <option value="pointillism">Pointillisme</option>
                            <option value="symbolism">Symbolisme</option>
                            <option value="artnouveau">Art Nouveau</option>
                        </optgroup>
                        <optgroup label="Modernes/Graphiques">
                            <option value="chalkboard">Tableau Craie</option>
                            <option value="glitchart">Glitch Art</option>
                            <option value="holographic">Holographique</option>
                            <option value="holographicretro">Holographique Rétro</option>
                            <option value="lowpoly">Low Poly</option>
                            <option value="minimalist">Minimaliste</option>
                            <option value="papercut">Papercut</option>
                            <option value="pixelart">Pixel Art</option>
                            <option value="vectorart">Vector Art</option>
                            <option value="flatdesign">Design Plat</option>
                            <option value="isometric">Isométrique</option>
                            <option value="lineart">Art au trait</option>
                            <option value="silhouette">Silhouette</option>
                            <option value="geometric">Géométrique</option>
                            <option value="abstract">Abstrait</option>
                            <option value="futuristic">Futuriste</option>
                            <option value="collage">Collage</option>
                            <option value="retro">Rétro</option>
                            <option value="vintage">Vintage</option>
                            <option value="monochrome">Monochrome</option>
                        </optgroup>
                        <optgroup label="Futuristes">
                            <option value="afrofuturism">Afrofuturisme</option>
                            <option value="biopunk">Biopunk</option>
                            <option value="cyberpunk">Cyberpunk</option>
                            <option value="dieselpunk">Dieselpunk</option>
                            <option value="neonnoir">Néon Noir</option>
                            <option value="retrofuture">Rétrofuturiste</option>
                            <option value="solarpunk">Solarpunk</option>
                            <option value="synthwave">Synthwave</option>
                            <option value="steampunk">Steampunk</option>
                            <option value="nanopunk">Nanopunk</option>
                            <option value="postcyberpunk">Post-Cyberpunk</option>
                            <option value="atompunk">Atompunk</option>
                            <option value="raypunk">Raypunk</option>
                            <option value="cyberprep">Cyberprep</option>
                            <option value="teslapunk">Teslapunk</option>
                            <option value="spaceopera">Opéra spatial</option>
                            <option value="scifi">Science-fiction</option>
                            <option value="technoir">Tech Noir</option>
                            <option value="arcology">Arcology</option>
                            <option value="transhuman">Transhumaniste</option>
                        </optgroup>
                        <optgroup label="Fantastiques/Magiques">
                            <option value="bioluminescent">Bioluminescent</option>
                            <option value="biopoetic">Biopoétique</option>
                            <option value="dreamscape">Paysage Onirique</option>
                            <option value="enchanted">Enchanté</option>
                            <option value="ethereal">Éthéré</option>
                            <option value="fantasy">Fantaisie</option>
                            <option value="luminist">Luministe</option>
                            <option value="mythic">Mythique</option>
                            <option value="whimsical">Fantaisiste</option>
                            <option value="magicalrealism">Réalisme magique</option>
                            <option value="fairytale">Conte de fées</option>
                            <option value="otherworldly">Autre monde</option>
                            <option value="arcane">Arcane</option>
                            <option value="celestial">Céleste</option>
                            <option value="divine">Divin</option>
                            <option value="mystical">Mystique</option>
                            <option value="occult">Occulte</option>
                            <option value="storybook">Livre d'histoires</option>
                            <option value="epicfantasy">Fantaisie épique</option>
                            <option value="darkfantasy">Fantaisie sombre</option>
                        </optgroup>
                        <optgroup label="Sombres/Dramatiques">
                            <option value="apocalyptic">Apocalyptique</option>
                            <option value="gothic">Gothique</option>
                            <option value="noir">Noir (Film Noir)</option>
                            <option value="xenomorphic">Xénomorphe</option>
                            <option value="horror">Horreur</option>
                            <option value="grimdark">Grimdark</option>
                            <option value="dystopian">Dystopique</option>
                            <option value="postapocalyptic">Post-apocalyptique</option>
                            <option value="macabre">Macabre</option>
                            <option value="surrealhorror">Horreur surréaliste</option>
                            <option value="cosmic horror">Horreur cosmique</option>
                            <option value="gothpunk">Gothpunk</option>
                            <option value="darkart">Art sombre</option>
                            <option value="haunted">Hanté</option>
                            <option value="melancholic">Mélancolique</option>
                            <option value="tragic">Tragique</option>
                            <option value="shadowy">Ombrageux</option>
                            <option value="eerie">Étrange</option>
                            <option value="sinister">Sinistre</option>
                            <option value="brooding">Méditatif</option>
                        </optgroup>
                        <optgroup label="Vibrants/Alternatifs">
                            <option value="fractal">Fractal</option>
                            <option value="graffiti">Graffiti</option>
                            <option value="grunge">Grunge</option>
                            <option value="kawaii">Kawaii</option>
                            <option value="prismatic">Prismatique</option>
                            <option value="psychedelic">Psychédélique</option>
                            <option value="vaporwave">Vaporwave</option>
                            <option value="retrowave">Retrowave</option>
                            <option value="synthpop">Synthpop</option>
                            <option value="streetart">Art de rue</option>
                            <option value="popculture">Culture pop</option>
                            <option value="neon">Néon</option>
                            <option value="chromatic">Chromatique</option>
                            <option value="bold">Audacieux</option>
                            <option value="eclectic">Éclectique</option>
                            <option value="bohemian">Bohème</option>
                            <option value="tropical">Tropical</option>
                            <option value="floral">Floral</option>
                            <option value="vibrant">Vibrant</option>
                            <option value="retrocomic">Bande dessinée rétro</option>
                        </optgroup>
                        <optgroup label="Décoratifs">
                            <option value="claymation">Claymation</option>
                            <option value="knitted">Tricoté</option>
                            <option value="origami">Origami</option>
                            <option value="stainedglass">Vitrail</option>
                            <option value="velvet">Velours</option>
                            <option value="embroidery">Broderie</option>
                            <option value="quilted">Matelassé</option>
                            <option value="porcelain">Porcelaine</option>
                            <option value="woodcarving">Sculpture sur bois</option>
                            <option value="metalwork">Travail du métal</option>
                            <option value="calligraphy">Calligraphie</option>
                            <option value="illuminated">Enluminé</option>
                            <option value="tapestry">Tapisserie</option>
                            <option value="ceramic">Céramique</option>
                            <option value="mosaicglass">Mosaïque de verre</option>
                            <option value="lace">Dentelle</option>
                            <option value="beaded">Perlé</option>
                            <option value="etched">Gravé</option>
                            <option value="woven">Tissé</option>
                            <option value="sculptural">Sculptural</option>
                        </optgroup>
                        <optgroup label="Cosmiques">
                            <option value="cosmic">Cosmique</option>
                            <option value="microscopic">Microscopique</option>
                            <option value="astral">Astral</option>
                            <option value="nebula">Nébuleuse</option>
                            <option value="stellar">Stellaire</option>
                            <option value="galactic">Galactique</option>
                            <option value="interstellar">Interstellaire</option>
                            <option value="planetary">Planétaire</option>
                            <option value="lunar">Lunaire</option>
                            <option value="solar">Solaire</option>
                            <option value="astrological">Astrologique</option>
                            <option value="space">Espace</option>
                            <option value="void">Vide</option>
                            <option value="etherealcosmic">Cosmique éthéré</option>
                            <option value="darkcosmic">Cosmique sombre</option>
                            <option value="starglow">Éclat d'étoiles</option>
                            <option value="meteor">Météore</option>
                            <option value="aurora">Aurore</option>
                            <option value="blackhole">Trou noir</option>
                            <option value="supernova">Supernova</option>
                        </optgroup>
                        <optgroup label="Audacieux">
                            <option value="boudoir">Boudoir</option>
                            <option value="cabaret">Cabaret</option>
                            <option value="erotic">Érotique</option>
                            <option value="fetishnoir">Fetish Noir</option>
                            <option value="pinup">Pin-Up</option>
                            <option value="burlesque">Burlesque</option>
                            <option value="glamour">Glamour</option>
                            <option value="provocative">Provocateur</option>
                            <option value="seductive">Séducteur</option>
                            <option value="noirglam">Glamour Noir</option>
                            <option value="retroglam">Glamour rétro</option>
                            <option value="avantgarde">Avant-garde</option>
                            <option value="extravagant">Extravagant</option>
                            <option value="baroque glamour">Glamour baroque</option>
                            <option value="highfashion">Haute couture</option>
                            <option value="edgy">Audacieux</option>
                            <option value="rebellious">Rebelle</option>
                            <option value="dramatic">Dramatique</option>
                            <option value="theatrical">Théâtral</option>
                            <option value="opulent">Opulent</option>
                        </optgroup>
                    </select>
                </div>

                <div class="form-group">
                    <label>Options</label>
                    <div class="checkbox-group">
                        <input type="checkbox" id="enhance" checked>
                        <label for="enhance">Améliorer la description avec l'IA</label>
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="high-detail">
                        <label for="high-detail">Haute résolution (8k, détails élevés)</label>
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="safe">
                        <label for="safe">Filtre NSFW</label>
                    </div>
                </div>

                <div class="form-group">
                    <label for="prompt">Description de l'image</label>
                    <textarea id="prompt" placeholder="Décrivez l'image que vous souhaitez générer..."></textarea>
                </div>

                <div class="batch-container">
                    <select id="batch-size">
                        <option value="1" selected>1x</option>
                        <option value="2">2x</option>
                        <option value="3">3x</option>
                        <option value="4">4x</option>
                        <option value="5">5x</option>
                        <option value="6">6x</option>
                        <option value="7">7x</option>
                        <option value="8">8x</option>
                        <option value="9">9x</option>
                        <option value="10">10x</option>
                    </select>
                    <button id="generate-btn" class="btn btn-block">
                        <i class="fas fa-magic"></i> Générer l'image
                    </button>
                </div>
            </div>
            <div class="image-preview">
                <div id="loading" class="loading">
                    <div class="spinner"></div>
                    <p>Génération de votre image...</p>
                </div>
                <div id="placeholder" class="placeholder">
                    <i class="fas fa-image"></i>
                    <p>Votre image générée apparaîtra ici</p>
                </div>
                <img id="generated-image" class="generated-image" alt="Image générée">
            </div>
        </div>

        <div class="history">
            <div class="history-header">
                <h3>Historique des générations</h3>
                <button id="clear-history-btn" class="btn btn-danger">
                    <i class="fas fa-trash"></i> Effacer l'Historique
                </button>
            </div>
            <div id="history-items" class="history-items"></div>
        </div>

        <footer>
            <p>Propulsé par Elgabo ✨</p><br>
        </footer>
    </div>

    <div id="image-overlay" class="image-overlay">
        <img id="overlay-image" src="" alt="Image agrandie">
        <button class="close-btn" id="close-overlay"><i class="fas fa-times"></i></button>
        <button class="delete-btn" id="overlay-delete"><i class="fas fa-trash"></i> Supprimer</button>
        <div class="overlay-buttons">
            <button class="copy-btn copy-btn-mobile" id="overlay-copy"><i class="fas fa-copy"></i> Copier</button>
            <button class="download-btn" id="overlay-download"><i class="fas fa-download"></i> Télécharger</button>
        </div>
    </div>

    <div id="toast" class="toast"></div>

    <script>
        // Version: 1.0.4
        document.addEventListener('DOMContentLoaded', () => {
            // State variables
            let isGenerating = false;
            let isWaiting = false;
            let currentPrompt = '';
            let abortController = null;
            let batchInProgress = false;
            let batchCount = 0;
            let currentBatchSize = 0;
            let lastClickTime = 0;
            const isMobile = window.matchMedia("(max-width: 768px)").matches;

            // DOM elements
            const elements = {
                prompt: document.getElementById('prompt'),
                model: document.getElementById('model'),
                dimensions: document.getElementById('dimensions'),
                seed: document.getElementById('seed'),
                style: document.getElementById('style'),
                batchSize: document.getElementById('batch-size'),
                generateBtn: document.getElementById('generate-btn'),
                clearSeedBtn: document.getElementById('clear-seed-btn'),
                clearHistoryBtn: document.getElementById('clear-history-btn'),
                generatedImage: document.getElementById('generated-image'),
                placeholder: document.getElementById('placeholder'),
                loading: document.getElementById('loading'),
                imageOverlay: document.getElementById('image-overlay'),
                overlayImage: document.getElementById('overlay-image'),
                overlayDownload: document.getElementById('overlay-download'),
                overlayCopy: document.getElementById('overlay-copy'),
                overlayDelete: document.getElementById('overlay-delete'),
                closeOverlay: document.getElementById('close-overlay'),
                enhance: document.getElementById('enhance'),
                highDetail: document.getElementById('high-detail'),
                safe: document.getElementById('safe')
            };

            // Initial reset
            resetForm();

            // Hide copy button on mobile
            if (isMobile) elements.overlayCopy.style.display = 'none';

            // Handle Enter key on prompt textarea
            elements.prompt.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' && !e.shiftKey) {
                    if (!isMobile) {
                        e.preventDefault();
                        if (!isGenerating && !batchInProgress) generateImage();
                    }
                }
            });

            // Generate button handler
            elements.generateBtn.addEventListener('click', () => {
                if (batchInProgress) {
                    stopBatchGeneration();
                } else if (isGenerating) {
                    stopGeneration();
                } else {
                    const batchSize = parseInt(elements.batchSize.value);
                    if (batchSize > 1) startBatchGeneration(batchSize);
                    else generateImage();
                }
            });

            // Clear seed button
            elements.clearSeedBtn.addEventListener('click', () => {
                elements.seed.value = '';
            });

            // Clear history button
            elements.clearHistoryBtn.addEventListener('click', () => {
                if (window.confirm('Voulez-vous vraiment effacer tout l\'historique des images générées ? Cette action est irréversible.')) {
                    clearHistory();
                }
            });

            // Generated image click to show overlay
            elements.generatedImage.addEventListener('click', () => {
                if (elements.generatedImage.classList.contains('show') && elements.generatedImage.src) {
                    elements.overlayImage.src = elements.generatedImage.src;
                    setTimeout(() => elements.imageOverlay.classList.add('show'), 0);
                }
            });

            // Overlay download button
            elements.overlayDownload.addEventListener('click', () => {
                const base64Data = elements.overlayImage.src.split(',')[1];
                const byteCharacters = atob(base64Data);
                const byteNumbers = new Array(byteCharacters.length);
                for (let i = 0; i < byteCharacters.length; i++) byteNumbers[i] = byteCharacters.charCodeAt(i);
                const byteArray = new Uint8Array(byteNumbers);
                const blob = new Blob([byteArray], { type: 'image/jpeg' });
                const url = window.URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                link.download = generateFileName(currentPrompt);
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                window.URL.revokeObjectURL(url);
            });

            // Overlay copy button
            elements.overlayCopy.addEventListener('click', () => {
                convertToPng(elements.overlayImage.src)
                    .then(blob => {
                        const item = new ClipboardItem({ 'image/png': blob });
                        return navigator.clipboard.write([item]);
                    })
                    .then(() => showToast('Image copiée dans le presse-papiers !', 'success'))
                    .catch(error => {
                        console.error('Failed to copy image:', error);
                        showToast('Erreur lors de la copie de l\'image. Essayez un autre navigateur.', 'error');
                    });
            });

            // Overlay delete button
            elements.overlayDelete.addEventListener('click', () => {
                const imageUrl = elements.overlayImage.src;
                let history = JSON.parse(localStorage.getItem('imageHistory') || '[]');
                history = history.filter(item => item.imageUrl !== imageUrl);
                localStorage.setItem('imageHistory', JSON.stringify(history));
                loadHistory();
                showToast('Image supprimée de l\'historique !', 'success');
                elements.generatedImage.classList.remove('show');
                elements.generatedImage.src = '';
                elements.placeholder.style.display = 'block';
                resetForm();
                elements.imageOverlay.classList.remove('show');
            });

            // Close overlay
            elements.closeOverlay.addEventListener('click', () => {
                elements.imageOverlay.classList.remove('show');
            });

            elements.imageOverlay.addEventListener('click', (e) => {
                if (e.target === elements.imageOverlay) elements.imageOverlay.classList.remove('show');
            });

            // Utility functions
            function resetForm() {
                elements.prompt.value = '';
                elements.model.value = 'flux';
                elements.dimensions.value = '1280x720';
                elements.seed.value = '';
                elements.style.value = 'default';
                elements.batchSize.value = '1';
                elements.generatedImage.classList.remove('show');
                elements.placeholder.style.display = 'block';
                elements.imageOverlay.classList.remove('show');
                elements.enhance.checked = true;
                elements.highDetail.checked = false;
                elements.safe.checked = false;
            }

            function centerImageOnMobile() {
                if (isMobile) {
                    setTimeout(() => {
                        document.querySelector('.image-preview').scrollIntoView({ behavior: 'smooth', block: 'center' });
                    }, 200);
                }
            }

            function loadHistory() {
                const history = JSON.parse(localStorage.getItem('imageHistory') || '[]');
                const historyContainer = document.getElementById('history-items');
                const historySection = document.querySelector('.history');

                historyContainer.innerHTML = '';
                historySection.classList.toggle('show', history.length > 0);

                history.forEach(item => {
                    const historyItem = document.createElement('div');
                    historyItem.className = 'history-item';
                    historyItem.innerHTML = `
                        <img src="${item.imageUrl}" alt="${item.originalPrompt}">
                        <button class="history-preview-btn"><i class="fas fa-eye"></i></button>
                        <button class="history-delete-btn"><i class="fas fa-times"></i></button>
                        <div class="prompt">${item.originalPrompt}</div>
                    `;

                    historyItem.querySelector('.history-preview-btn').addEventListener('click', (e) => {
                        e.stopPropagation();
                        elements.overlayImage.src = item.imageUrl;
                        setTimeout(() => elements.imageOverlay.classList.add('show'), 0);
                    });

                    historyItem.querySelector('.history-delete-btn').addEventListener('click', (e) => {
                        e.stopPropagation();
                        let history = JSON.parse(localStorage.getItem('imageHistory') || '[]');
                        history = history.filter(h => h.imageUrl !== item.imageUrl);
                        localStorage.setItem('imageHistory', JSON.stringify(history));
                        loadHistory();
                        showToast('Image supprimée de l\'historique !', 'success');
                        if (elements.generatedImage.src === item.imageUrl) {
                            elements.generatedImage.classList.remove('show');
                            elements.generatedImage.src = '';
                            elements.placeholder.style.display = 'block';
                        }
                    });

                    historyItem.addEventListener('click', () => {
                        const now = Date.now();
                        if (now - lastClickTime < 300) return;
                        lastClickTime = now;

                        elements.prompt.value = item.originalPrompt;
                        elements.generatedImage.classList.remove('show');
                        setTimeout(() => {
                            elements.generatedImage.src = item.imageUrl;
                            elements.generatedImage.classList.add('show');
                            elements.placeholder.style.display = 'none';
                        }, 300);

                        elements.seed.value = item.seed || '';
                        elements.model.value = item.model || 'flux';
                        elements.dimensions.value = item.dimensions || '1280x720';
                        elements.style.value = item.style || 'default';
                        currentPrompt = item.originalPrompt;
                    });

                    historyContainer.appendChild(historyItem);
                });
            }

            function clearHistory() {
                localStorage.removeItem('imageHistory');
                loadHistory();
                elements.generatedImage.classList.remove('show');
                elements.generatedImage.src = '';
                elements.placeholder.style.display = 'block';
                resetForm();
                showToast('Historique effacé !', 'success');
            }

            function showToast(message, type = '') {
                const toast = document.getElementById('toast');
                toast.textContent = message;
                toast.className = 'toast';
                if (type) toast.classList.add(type);
                if (isMobile) toast.style.fontSize = '0.8rem';
                setTimeout(() => toast.classList.add('show'), 100);
                setTimeout(() => toast.classList.remove('show'), 3000);
            }

            function startCooldown() {
                isWaiting = true;
                let timeLeft = 3;
                elements.generateBtn.disabled = true;
                const originalText = '<i class="fas fa-magic"></i> Générer l\'image';
                elements.generateBtn.innerHTML = `Attendez ${timeLeft}s`;

                const countdown = setInterval(() => {
                    timeLeft--;
                    elements.generateBtn.innerHTML = `Attendez ${timeLeft}s`;
                    if (timeLeft <= 0) {
                        clearInterval(countdown);
                        elements.generateBtn.innerHTML = batchInProgress ? '<i class="fas fa-stop"></i> Arrêter le batch' : originalText;
                        elements.generateBtn.disabled = false;
                        isWaiting = false;
                    }
                }, 1000);
            }

            function generateFileName(prompt) {
                let cleanPrompt = prompt
                    .normalize('NFD').replace(/[\u0300-\u036f]/g, '')
                    .replace(/[^a-zA-Z0-9\s-]/g, '')
                    .trim()
                    .replace(/\s+/g, '-')
                    .toLowerCase();
                if (cleanPrompt.length > 50) {
                    cleanPrompt = cleanPrompt.substring(0, 50);
                    cleanPrompt = cleanPrompt.substring(0, cleanPrompt.lastIndexOf('-') + 1) || cleanPrompt;
                }
                return cleanPrompt ? `${cleanPrompt}.jpg` : 'image-ia.jpg';
            }

            function blobToBase64(blob) {
                return new Promise((resolve, reject) => {
                    const reader = new FileReader();
                    reader.onloadend = () => resolve(reader.result);
                    reader.onerror = reject;
                    reader.readAsDataURL(blob);
                });
            }

            function convertToPng(imageSrc) {
                return new Promise((resolve, reject) => {
                    const img = new Image();
                    img.crossOrigin = 'Anonymous';
                    img.onload = () => {
                        const canvas = document.createElement('canvas');
                        canvas.width = img.width;
                        canvas.height = img.height;
                        const ctx = canvas.getContext('2d');
                        ctx.drawImage(img, 0, 0);
                        canvas.toBlob(blob => blob ? resolve(blob) : reject(new Error('Failed to convert image to PNG')), 'image/png');
                    };
                    img.onerror = () => reject(new Error('Failed to load image for conversion'));
                    img.src = imageSrc;
                });
            }

            function stopGeneration() {
                if (abortController) abortController.abort();
                isGenerating = false;
                elements.loading.style.display = 'none';
                elements.placeholder.style.display = 'block';
                elements.generatedImage.classList.remove('show');
                elements.generatedImage.src = '';
                elements.generateBtn.innerHTML = '<i class="fas fa-magic"></i> Générer l\'image';
                showToast('Génération arrêtée.', 'error');
                elements.seed.value = '';
                startCooldown();
            }

            function stopBatchGeneration() {
                if (abortController) abortController.abort();
                isGenerating = false;
                batchInProgress = false;
                batchCount = 0;
                currentBatchSize = 0;
                elements.loading.style.display = 'none';
                elements.placeholder.style.display = 'block';
                elements.generatedImage.classList.remove('show');
                elements.generatedImage.src = '';
                elements.generateBtn.innerHTML = '<i class="fas fa-magic"></i> Générer l\'image';
                showToast('Génération par batch arrêtée.', 'error');
                elements.seed.value = '';
                startCooldown();
            }

            async function startBatchGeneration(batchSize) {
                if (isWaiting || batchInProgress) {
                    showToast('Veuillez attendre avant de lancer un nouveau batch.', 'error');
                    return;
                }

                const prompt = elements.prompt.value.trim();
                if (!prompt) {
                    showToast('Veuillez entrer une description', 'error');
                    return;
                }

                currentPrompt = prompt;
                batchInProgress = true;
                currentBatchSize = batchSize;
                batchCount = 0;

                elements.generateBtn.innerHTML = '<i class="fas fa-stop"></i> Arrêter le batch';

                for (let i = 0; i < batchSize && batchInProgress; i++) {
                    await generateImage();
                    if (batchInProgress && i < batchSize - 1) await new Promise(resolve => setTimeout(resolve, 3000));
                }

                if (batchInProgress) {
                    batchInProgress = false;
                    batchCount = 0;
                    currentBatchSize = 0;
                    elements.generateBtn.innerHTML = '<i class="fas fa-magic"></i> Générer l\'image';
                }
            }

            async function generateImage() {
                if (isWaiting && !batchInProgress) {
                    showToast('Veuillez attendre avant de générer une nouvelle image.', 'error');
                    return;
                }

                const prompt = elements.prompt.value.trim();
                if (!prompt) {
                    showToast('Veuillez entrer une description', 'error');
                    return;
                }

                currentPrompt = prompt;
                isGenerating = true;
                abortController = new AbortController();

                elements.loading.style.display = 'flex';
                elements.placeholder.style.display = 'none';
                elements.generatedImage.classList.remove('show');
                elements.generateBtn.innerHTML = '<i class="fas fa-stop"></i> Arrêter';
                elements.generateBtn.disabled = false;

                centerImageOnMobile();

                const model = elements.model.value;
                const dimensions = elements.dimensions.value;
                const [width, height] = dimensions.split('x').map(Number);
                let seed = elements.seed.value.trim();
                const style = elements.style.value;
                const enhance = elements.enhance.checked;
                const highDetail = elements.highDetail.checked;
                const safe = elements.safe.checked;

                let finalPrompt = prompt;
                if (style !== 'default') finalPrompt += `, in ${style} style`;
                if (highDetail) finalPrompt = `highly detailed, 8k resolution, ${finalPrompt}`;

                const aspectRatio = {
                    '512x512': '1:1',
                    '1024x1024': '1:1',
                    '800x600': '4:3',
                    '1024x576': '16:9',
                    '1280x720': '16:9',
                    '600x800': '3:4',
                    '576x1024': '9:16',
                    '720x1280': '9:16',
                    '1600x400': '4:1',
                    '1920x480': '4:1',
                    '2048x512': '4:1'
                }[dimensions] || `${width}:${height}`;

                finalPrompt += `, aspect ratio ${aspectRatio}`;
                finalPrompt = finalPrompt.replace(/[^\x20-\x7E]/g, '');

                seed = seed || Math.floor(Math.random() * 1000000).toString();
                if (isNaN(parseInt(seed))) seed = Math.floor(Math.random() * 1000000).toString();

                let apiUrl = `https://image.pollinations.ai/prompt/${encodeURIComponent(finalPrompt)}`;
                apiUrl += `?model=${model}&width=${width}&height=${height}&nologo=true&private=true`;
                if (seed) apiUrl += `&seed=${seed}`;
                if (enhance) apiUrl += `&enhance=true`;
                if (safe) apiUrl += `&safe=true`;
                apiUrl += `&tamp=${Date.now()}`;

                try {
                    const response = await fetch(apiUrl, { signal: abortController.signal });
                    if (!response.ok) throw new Error('Échec de la génération de l\'image.');

                    const blob = await response.blob();
                    const base64Image = await blobToBase64(blob);

                    elements.generatedImage.src = base64Image;
                    elements.generatedImage.classList.add('show');
                    elements.loading.style.display = 'none';
                    elements.seed.value = '';

                    addToHistory({ originalPrompt: prompt, imageUrl: base64Image, model, dimensions, style, seed });
                    showToast('Image générée avec succès !', 'success');
                    centerImageOnMobile();
                } catch (error) {
                    if (error.name === 'AbortError') {
                        showToast('Génération annulée.', 'error');
                    } else {
                        console.error('Erreur lors de la génération:', error);
                        showToast(error.message || 'Erreur lors de la génération de l\'image.', 'error');
                        elements.placeholder.style.display = 'block';
                    }
                    elements.seed.value = '';
                } finally {
                    isGenerating = false;
                    elements.loading.style.display = 'none';
                    elements.generateBtn.innerHTML = '<i class="fas fa-magic"></i> Générer l\'image';
                    startCooldown();
                }
            }

            function addToHistory(item) {
                let history = JSON.parse(localStorage.getItem('imageHistory') || '[]');
                history.unshift(item);
                if (history.length > 30) history.pop(); // Remove oldest item if history exceeds 30
                localStorage.setItem('imageHistory', JSON.stringify(history));
                loadHistory();
            }

            loadHistory();
        });
    </script>